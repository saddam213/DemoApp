<CommonControls:BaseControl x:Class="DemoApp.Controls.HistoryControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:scm="clr-namespace:System.ComponentModel;assembly=WindowsBase"
             xmlns:base="clr-namespace:DemoApp"
             xmlns:local="clr-namespace:DemoApp.Controls"
             xmlns:Behaviors="clr-namespace:TensorStack.WPF.Behaviors;assembly=TensorStack.WPF"
             xmlns:CommonControls="clr-namespace:TensorStack.WPF.Controls;assembly=TensorStack.WPF"
             xmlns:CommonConverters="clr-namespace:TensorStack.WPF.Converters;assembly=TensorStack.WPF"
             xmlns:Controls="clr-namespace:DemoApp.Controls"
             xmlns:Common="clr-namespace:DemoApp.Common"
             xmlns:Views="clr-namespace:DemoApp.Views">

    <CommonControls:BaseControl.Resources>

        <!--UpscaleImageItem-->
        <DataTemplate  DataType="{x:Type Common:UpscaleItem}" >
            <Grid x:Name="Root" Background="Transparent" >
                <DockPanel Height="150" Width="110" >

                    <Grid DockPanel.Dock="Top">

                        <CommonControls:TransparentImageElement Height="110" Stretch="Uniform" >
                            <CommonControls:TransparentImageElement.Source>
                                <BitmapImage DecodePixelHeight="110" UriSource="{Binding ThumbPath, Converter={StaticResource StringToUriConverter}}" />
                            </CommonControls:TransparentImageElement.Source>
                        </CommonControls:TransparentImageElement>

                        <Button  Width="30" Height="30" 
                            Style="{StaticResource TransparentButton}"
                            HorizontalAlignment="Right" 
                            VerticalAlignment="Bottom" 
                            Visibility="{Binding IsMouseOver, ElementName=Root, Converter={StaticResource BooleanToHiddenConverter}}"
                            Command="{Binding RemoveItemCommand, RelativeSource={RelativeSource AncestorType=Controls:HistoryControl}}"
                            CommandParameter="{Binding}">
                            <CommonControls:FontAwesome Icon="&#xe2b4;" IconStyle="Solid" Size="20" Color="{StaticResource DangerColour}"  />
                        </Button>
                    </Grid>

                    <StackPanel>
                        <TextBlock TextAlignment="Center" FontSize="10" Opacity=".6">
                         <Run Text="{Binding Width}" />
                         <Run Text="x" />
                         <Run Text="{Binding Height}" />
                        </TextBlock>
                        <TextBlock Text="{Binding Source}" TextAlignment="Center" Opacity=".9"/>
                    </StackPanel>
                </DockPanel>


                <!-- Popup card -->
                <Popup x:Name="CardPopup"
                    Height="120"
                    Width="242"
                    VerticalOffset="16"
                    HorizontalOffset="-5"
                    Placement="Top"
                    StaysOpen="True"
                    PopupAnimation="Slide"
                    AllowsTransparency="True" >
                    <Border Background="#01000000" Margin="0,0,0,0">
                        <Border Margin="0,0,0,18" Background="#80000000" BorderBrush="{StaticResource ContainerBorder}" BorderThickness="1,1,1,0"  CornerRadius="6,6,0,0">
                            <StackPanel Margin="6,4,6,6">
                                <TextBlock Text="{Binding Source}" />
                                <TextBlock Text="{Binding Width, StringFormat={}Width: {0}}" />
                                <TextBlock Text="{Binding Height, StringFormat={}Height: {0}}" />
                                <TextBlock Text="{Binding Model, StringFormat={}Model: {0}}" />
                                <TextBlock Text="{Binding MediaPath}" />
                            </StackPanel>
                        </Border>
                    </Border>
                </Popup>

                <!-- Hover triggers -->
                <Grid.Triggers>
                    <EventTrigger RoutedEvent="MouseEnter">
                        <BeginStoryboard>
                            <Storyboard>
                                <BooleanAnimationUsingKeyFrames Storyboard.TargetName="CardPopup" Storyboard.TargetProperty="IsOpen">
                                    <DiscreteBooleanKeyFrame KeyTime="0:0:0" Value="True"/>
                                </BooleanAnimationUsingKeyFrames>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                    <EventTrigger RoutedEvent="MouseLeave">
                        <BeginStoryboard>
                            <Storyboard>
                                <BooleanAnimationUsingKeyFrames Storyboard.TargetName="CardPopup" Storyboard.TargetProperty="IsOpen">
                                    <DiscreteBooleanKeyFrame KeyTime="0:0:0" Value="False"/>
                                </BooleanAnimationUsingKeyFrames>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                </Grid.Triggers>
            </Grid>
        </DataTemplate>

        <!--ExtractorItem-->
        <DataTemplate  DataType="{x:Type Common:ExtractorItem}">
            <Grid x:Name="Root" Background="Transparent" >
                <DockPanel Height="150" Width="110" >
                    <Grid DockPanel.Dock="Top">

                        <CommonControls:TransparentImageElement Height="110" Stretch="Uniform" >
                            <CommonControls:TransparentImageElement.Source>
                                <BitmapImage DecodePixelHeight="110" UriSource="{Binding ThumbPath, Converter={StaticResource StringToUriConverter}}" />
                            </CommonControls:TransparentImageElement.Source>
                        </CommonControls:TransparentImageElement>

                        <Button  Width="30" Height="30" 
                            Style="{StaticResource TransparentButton}"
                            HorizontalAlignment="Right" 
                            VerticalAlignment="Bottom" 
                            Visibility="{Binding IsMouseOver, ElementName=Root, Converter={StaticResource BooleanToHiddenConverter}}"
                            Command="{Binding RemoveItemCommand, RelativeSource={RelativeSource AncestorType=Controls:HistoryControl}}"
                            CommandParameter="{Binding}">
                            <CommonControls:FontAwesome Icon="&#xe2b4;" IconStyle="Solid" Size="20" Color="{StaticResource DangerColour}"  />
                        </Button>
                    </Grid>
                    <StackPanel>
                        <TextBlock TextAlignment="Center">
                         <Run Text="{Binding Width}" />
                         <Run Text="x" />
                         <Run Text="{Binding Height}" />
                        </TextBlock>
                        <TextBlock Text="{Binding Source}" TextAlignment="Center" />
                    </StackPanel>
                </DockPanel>


                <!-- Popup card -->
                <Popup x:Name="CardPopup"
                    Height="120"
                    Width="242"
                    VerticalOffset="16"
                    HorizontalOffset="-5"
                    Placement="Top"
                    StaysOpen="True"
                    PopupAnimation="Slide"
                    AllowsTransparency="True" >
                    <Border Background="#01000000" Margin="0,0,0,0">
                        <Border Margin="0,0,0,18" Background="#80000000" BorderBrush="{StaticResource ContainerBorder}" BorderThickness="1,1,1,0"  CornerRadius="6,6,0,0">
                            <StackPanel Margin="6,4,6,6">
                                <TextBlock Text="{Binding Source}" />
                                <TextBlock Text="{Binding Width, StringFormat={}Width: {0}}" />
                                <TextBlock Text="{Binding Height, StringFormat={}Height: {0}}" />
                                <TextBlock Text="{Binding Model, StringFormat={}Model: {0}}" />
                                <TextBlock Text="{Binding MediaPath}" />
                            </StackPanel>
                        </Border>
                    </Border>
                </Popup>

                <!-- Hover triggers -->
                <Grid.Triggers>
                    <EventTrigger RoutedEvent="MouseEnter">
                        <BeginStoryboard>
                            <Storyboard>
                                <BooleanAnimationUsingKeyFrames Storyboard.TargetName="CardPopup" Storyboard.TargetProperty="IsOpen">
                                    <DiscreteBooleanKeyFrame KeyTime="0:0:0" Value="True"/>
                                </BooleanAnimationUsingKeyFrames>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                    <EventTrigger RoutedEvent="MouseLeave">
                        <BeginStoryboard>
                            <Storyboard>
                                <BooleanAnimationUsingKeyFrames Storyboard.TargetName="CardPopup" Storyboard.TargetProperty="IsOpen">
                                    <DiscreteBooleanKeyFrame KeyTime="0:0:0" Value="False"/>
                                </BooleanAnimationUsingKeyFrames>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                </Grid.Triggers>
            </Grid>
        </DataTemplate>

        <!--LayerImageItem-->
        <DataTemplate  DataType="{x:Type Common:LayerImageItem}">
            <Grid x:Name="Root" Background="Transparent" >
                <DockPanel Height="150" Width="110" >
                    <Grid DockPanel.Dock="Top">
                        <CommonControls:TransparentImageElement Height="110" Stretch="Uniform" >
                            <CommonControls:TransparentImageElement.Source>
                                <BitmapImage DecodePixelHeight="110" UriSource="{Binding MediaPath, Converter={StaticResource StringToUriConverter}}" />
                            </CommonControls:TransparentImageElement.Source>
                        </CommonControls:TransparentImageElement>

                        <Button  Width="30" Height="30" 
                            Style="{StaticResource TransparentButton}"
                            HorizontalAlignment="Right" 
                            VerticalAlignment="Bottom" 
                            Visibility="{Binding IsMouseOver, ElementName=Root, Converter={StaticResource BooleanToHiddenConverter}}"
                            Command="{Binding RemoveItemCommand, RelativeSource={RelativeSource AncestorType=Controls:HistoryControl}}"
                            CommandParameter="{Binding}">
                            <CommonControls:FontAwesome Icon="&#xe2b4;" IconStyle="Solid" Size="20" Color="{StaticResource DangerColour}"  />
                        </Button>
                    </Grid>
                    <StackPanel>
                        <TextBlock TextAlignment="Center">
                         <Run Text="{Binding Width}" />
                         <Run Text="x" />
                         <Run Text="{Binding Height}" />
                        </TextBlock>
                        <TextBlock Text="{Binding Source}" TextAlignment="Center" />
                    </StackPanel>
                </DockPanel>


                <!-- Popup card -->
                <Popup x:Name="CardPopup"
                    Height="120"
                    Width="242"
                    VerticalOffset="16"
                    HorizontalOffset="-5"
                    Placement="Top"
                    StaysOpen="True"
                    PopupAnimation="Slide"
                    AllowsTransparency="True" >
                    <Border Background="#01000000" Margin="0,0,0,0">
                        <Border Margin="0,0,0,18" Background="#80000000" BorderBrush="{StaticResource ContainerBorder}" BorderThickness="1,1,1,0"  CornerRadius="6,6,0,0">
                            <StackPanel Margin="6,4,6,6">
                                <TextBlock Text="{Binding Source}" />
                                <TextBlock Text="{Binding Width, StringFormat={}Width: {0}}" />
                                <TextBlock Text="{Binding Height, StringFormat={}Height: {0}}" />
                                <TextBlock Text="{Binding Model, StringFormat={}Model: {0}}" />
                                <TextBlock Text="{Binding MediaPath}" />
                            </StackPanel>
                        </Border>
                    </Border>
                </Popup>

                <!-- Hover triggers -->
                <Grid.Triggers>
                    <EventTrigger RoutedEvent="MouseEnter">
                        <BeginStoryboard>
                            <Storyboard>
                                <BooleanAnimationUsingKeyFrames Storyboard.TargetName="CardPopup" Storyboard.TargetProperty="IsOpen">
                                    <DiscreteBooleanKeyFrame KeyTime="0:0:0" Value="True"/>
                                </BooleanAnimationUsingKeyFrames>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                    <EventTrigger RoutedEvent="MouseLeave">
                        <BeginStoryboard>
                            <Storyboard>
                                <BooleanAnimationUsingKeyFrames Storyboard.TargetName="CardPopup" Storyboard.TargetProperty="IsOpen">
                                    <DiscreteBooleanKeyFrame KeyTime="0:0:0" Value="False"/>
                                </BooleanAnimationUsingKeyFrames>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                </Grid.Triggers>
            </Grid>
        </DataTemplate>

        <!--GenerateImageItem-->
        <DataTemplate  DataType="{x:Type Common:DiffusionItem}">
            <Grid x:Name="Root" Background="Transparent" >
                <DockPanel Height="150" Width="110" >
                    <Grid DockPanel.Dock="Top">
                        <CommonControls:TransparentImageElement Height="110" Stretch="Uniform" >
                            <CommonControls:TransparentImageElement.Source>
                                <BitmapImage DecodePixelHeight="110" UriSource="{Binding MediaPath, Converter={StaticResource StringToUriConverter}}" />
                            </CommonControls:TransparentImageElement.Source>
                        </CommonControls:TransparentImageElement>

                        <Button  Width="30" Height="30" 
                            Style="{StaticResource TransparentButton}"
                            HorizontalAlignment="Right" 
                            VerticalAlignment="Bottom" 
                            Visibility="{Binding IsMouseOver, ElementName=Root, Converter={StaticResource BooleanToHiddenConverter}}"
                            Command="{Binding RemoveItemCommand, RelativeSource={RelativeSource AncestorType=Controls:HistoryControl}}"
                            CommandParameter="{Binding}">
                            <CommonControls:FontAwesome Icon="&#xe2b4;" IconStyle="Solid" Size="20" Color="{StaticResource DangerColour}"  />
                        </Button>
                    </Grid>
                    <StackPanel>
                        <TextBlock TextAlignment="Center">
                            <Run Text="{Binding Width}" />
                            <Run Text="x" />
                            <Run Text="{Binding Height}" />
                        </TextBlock>
                        <TextBlock Text="{Binding Source}" TextAlignment="Center" />
                    </StackPanel>
                </DockPanel>


                <!-- Popup card -->
                <Popup x:Name="CardPopup"
                    Height="120"
                    Width="242"
                    VerticalOffset="16"
                    HorizontalOffset="-5"
                    Placement="Top"
                    StaysOpen="True"
                    PopupAnimation="Slide"
                    AllowsTransparency="True" >
                    <Border Background="#01000000">
                        <Border Margin="0,0,0,18" Background="#80000000" BorderBrush="{StaticResource ContainerBorder}" BorderThickness="1,1,1,0"  CornerRadius="6,6,0,0">
                            <StackPanel Margin="6,4,6,6">
                                <TextBlock Text="{Binding Source}" />
                                <TextBlock Text="{Binding Width, StringFormat={}Width: {0}}" />
                                <TextBlock Text="{Binding Height, StringFormat={}Height: {0}}" />
                                <TextBlock Text="{Binding Model, StringFormat={}Model: {0}}" />
                                <TextBlock Text="{Binding MediaPath}" />
                            </StackPanel>
                        </Border>
                    </Border>
                </Popup>


                <!-- Hover triggers -->
                <Grid.Triggers>
                    <EventTrigger RoutedEvent="MouseEnter">
                        <BeginStoryboard>
                            <Storyboard>
                                <BooleanAnimationUsingKeyFrames Storyboard.TargetName="CardPopup" Storyboard.TargetProperty="IsOpen">
                                    <DiscreteBooleanKeyFrame KeyTime="0:0:0" Value="True"/>
                                </BooleanAnimationUsingKeyFrames>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                    <EventTrigger RoutedEvent="MouseLeave">
                        <BeginStoryboard>
                            <Storyboard>
                                <BooleanAnimationUsingKeyFrames Storyboard.TargetName="CardPopup" Storyboard.TargetProperty="IsOpen">
                                    <DiscreteBooleanKeyFrame KeyTime="0:0:0" Value="False"/>
                                </BooleanAnimationUsingKeyFrames>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                </Grid.Triggers>

       
            </Grid>
        </DataTemplate>



        <!--NarrateItem-->
        <DataTemplate  DataType="{x:Type Common:NarrateItem}">
            <Grid x:Name="Root" Background="Transparent" >
                <DockPanel Height="150" Width="110" >
                    <Grid DockPanel.Dock="Top">

                        <Grid Width="110" Height="110">
                            <CommonControls:FontAwesome Icon="f001" IconStyle="Solid" Size="70" Color="{StaticResource DefaultForeground}" Opacity=".2" />
                        </Grid>

                        <Button  Width="30" Height="30" 
                            Style="{StaticResource TransparentButton}"
                            HorizontalAlignment="Right" 
                            VerticalAlignment="Bottom" 
                            Visibility="{Binding IsMouseOver, ElementName=Root, Converter={StaticResource BooleanToHiddenConverter}}"
                            Command="{Binding RemoveItemCommand, RelativeSource={RelativeSource AncestorType=Controls:HistoryControl}}"
                            CommandParameter="{Binding}">
                            <CommonControls:FontAwesome Icon="&#xe2b4;" IconStyle="Solid" Size="20" Color="{StaticResource DangerColour}"  />
                        </Button>
                    </Grid>
                    <StackPanel>
                        <TextBlock TextAlignment="Center">
                            <Run Text="{Binding Duration}" />
                        </TextBlock>
                        <TextBlock Text="{Binding Source}" TextAlignment="Center" />
                    </StackPanel>
                </DockPanel>


                <!-- Popup card -->
                <Popup x:Name="CardPopup"
                    Height="120"
                    Width="242"
                    VerticalOffset="16"
                    HorizontalOffset="-5"
                    Placement="Top"
                    StaysOpen="True"
                    PopupAnimation="Slide"
                    AllowsTransparency="True" >
                    <Border Background="#01000000" Margin="0,0,0,0">
                        <Border Margin="0,0,0,18" Background="#80000000" BorderBrush="{StaticResource ContainerBorder}" BorderThickness="1,1,1,0"  CornerRadius="6,6,0,0">
                            <StackPanel Margin="6,4,6,6">
                                <TextBlock Text="{Binding Source}" />
                                <TextBlock Text="{Binding Model, StringFormat={}Model: {0}}" />
                                <TextBlock Text="{Binding Voice, StringFormat={}Voice: {0}}" />
                                <TextBlock Text="{Binding Seed, StringFormat={}Seed: {0}}" />
                                <TextBlock Text="{Binding Speed, StringFormat={}Speed: {0}}" />
                                <TextBlock Text="{Binding Steps, StringFormat={}Steps: {0}}" />
                                <TextBlock Text="{Binding Channels, StringFormat={}Channels: {0}}" />
                                <TextBlock Text="{Binding SampleRate, StringFormat={}SampleRate: {0}}" />
                                <TextBlock Text="{Binding Duration, StringFormat={}Duration: {0}}" />
                                <TextBlock Text="{Binding MediaPath}" />
                            </StackPanel>
                        </Border>
                    </Border>
                </Popup>

                <!-- Hover triggers -->
                <Grid.Triggers>
                    <EventTrigger RoutedEvent="MouseEnter">
                        <BeginStoryboard>
                            <Storyboard>
                                <BooleanAnimationUsingKeyFrames Storyboard.TargetName="CardPopup" Storyboard.TargetProperty="IsOpen">
                                    <DiscreteBooleanKeyFrame KeyTime="0:0:0" Value="True"/>
                                </BooleanAnimationUsingKeyFrames>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                    <EventTrigger RoutedEvent="MouseLeave">
                        <BeginStoryboard>
                            <Storyboard>
                                <BooleanAnimationUsingKeyFrames Storyboard.TargetName="CardPopup" Storyboard.TargetProperty="IsOpen">
                                    <DiscreteBooleanKeyFrame KeyTime="0:0:0" Value="False"/>
                                </BooleanAnimationUsingKeyFrames>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                </Grid.Triggers>
            </Grid>
        </DataTemplate>

    </CommonControls:BaseControl.Resources>

    <Grid  DataContext="{Binding RelativeSource={RelativeSource AncestorType={x:Type local:HistoryControl}}}">

        <TextBlock 
            Text="No History Items Found" 
            Opacity=".5" 
            FontSize="15"
            HorizontalAlignment="Center" 
            VerticalAlignment="Center"
            Visibility="{Binding CollectionView, Converter={StaticResource EmptyToVisibilityConverter}}" />

        <ScrollViewer 
            PanningMode="HorizontalOnly"
            PreviewMouseWheel="ScrollViewer_PreviewMouseWheel"
            HorizontalScrollBarVisibility="{Binding HorizontalScrollBarVisibility}" 
            VerticalScrollBarVisibility="{Binding VerticalScrollBarVisibility}" >
            <ListBox x:Name="ListBoxControl" 
                ItemsSource="{Binding CollectionView}" 
                VerticalAlignment="Top"
                SelectedItem="{Binding SelectedItem, Mode=TwoWay}"
                ItemTemplate="{Binding ItemTemplate}"
                ItemsPanel="{Binding ItemsPanelTemplate}"
                IsSynchronizedWithCurrentItem="True"
                ScrollViewer.VerticalScrollBarVisibility="Disabled" 
                ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                RequestBringIntoView="ListBox_RequestBringIntoView" 
                Background="{StaticResource TransparentBrush}"
                BorderThickness="0,0,0,0"
                Padding="0"
                PreviewMouseMove="ListBoxPreviewMouseMove">
                <ListBox.ItemContainerStyle>
                    <Style TargetType="{x:Type ListBoxItem}">
                        <Setter Property="Padding" Value="0"/>
                        <Setter Property="Margin" Value="0,1,3,1"/>
                        <Setter Property="BorderThickness" Value="1" />
                        <Setter Property="BorderBrush" Value="{StaticResource ContainerBorder}" />
                        <Setter Property="Background" Value="{StaticResource TransparentBrush}"/>
                        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="{x:Type ListBoxItem}">
                                    <Border Name="Border" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}">
                                        <ContentPresenter Content="{TemplateBinding Content}" ContentTemplate="{TemplateBinding ContentTemplate}" Margin="{TemplateBinding Padding}" />
                                    </Border>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
               
                    </Style>
                </ListBox.ItemContainerStyle>
            </ListBox>
        </ScrollViewer>
    </Grid>
</CommonControls:BaseControl>
